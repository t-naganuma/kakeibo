# (ファイル名: 技術選定.md)

# Kakeibo 技術選定

**バージョン:** 1.1
**作成日:** 2025年4月28日 (更新)

## 1. 概要
このドキュメントは、家計簿アプリ「Kakeibo」の開発における主要な技術スタックとアーキテクチャ方針を定義します。

## 2. アーキテクチャ
* **サーバーサイドレンダリング (SSR)** を採用します。
* フロントエンドと、API 提供および SSR を行うバックエンドサーバーを分離しつつ連携させる構成です。

## 3. バックエンド (API & SSRサーバー)
* **フレームワーク:** **Hono**
    * 高速で軽量な Web フレームワーク。様々な JavaScript ランタイムで動作。
* **ホスティング:** **AWS Lambda (+ API Gateway)**
    * Hono アプリケーションを Lambda 関数としてデプロイし、API Gateway 経由でアクセスするサーバーレス構成。
    * 従量課金でコスト効率が高く、スケーラブルな運用が可能。
* **役割:**
    * フロントエンド (React) への API 提供。
    * React アプリケーションのサーバーサイドレンダリング (SSR) 実行。
    * ビジネスロジック（計算、バリデーションなど）の実装。

## 4. データベース
* **サービス:** **Supabase DB**
    * Supabase が提供するマネージド PostgreSQL データベースを利用 (DBaaS として活用)。
* **接続方法:** AWS Lambda 上の Hono アプリから Supabase DB へ接続します。具体的な接続戦略（データベース接続プール、Supabase Data API (PostgREST) 経由など）は別途検討が必要です。

## 5. 認証
* **サービス:** **Supabase Auth**
    * ユーザー登録、ログイン、セッション管理などの認証基盤として利用します。
* **連携方法:**
    * フロントエンドで Supabase Auth ライブラリを利用して認証処理を行う。
    * 取得した認証トークン (JWT) を API リクエスト時に Hono サーバー (AWS Lambda) へ送信する。
    * Hono サーバー側でミドルウェア等を用いて JWT を検証し、ユーザーを識別する（`@supabase/ssr` 等の活用を検討）。
    * SSR 時の認証状態管理（Cookie 等の利用）も考慮が必要です。

## 6. フロントエンド
* **ライブラリ:** **React**
    * コンポーネントベースの UI 構築ライブラリ。
* **ルーティング:** **React Router v7**
    * SSR 環境との連携を考慮しつつ、データローディング (`loader`) やミューテーション (`action`) 機能も活用します。
* **UI コンポーネント:** **shadcn/ui**
    * Tailwind CSS ベースのコンポーネント集。Headless UI/Radix UI ベースでカスタマイズ性が高い。
* **スタイリング:** **Tailwind CSS**
    * ユーティリティファーストの CSS フレームワーク。
* **フォーム:** **Conform**
    * Web 標準に準拠し、React Router の `action` との連携がスムーズなフォームライブラリ。
* **ビルドツール:** **Vite**
    * 高速な開発サーバーとビルド機能を提供。Hono や React SSR との連携設定を行います。
* **ホスティング:** **Cloudflare Pages**
    * ビルドされた React アプリケーション (静的アセット + クライアントサイド JS) をホスティング。
    * 高速な配信と寛大な無料枠が特徴。

## 7. 状態管理
* **基本方針:** React 標準の Context API、`useState`, `useReducer` を中心に利用します。
* **必要に応じて:** アプリケーションの状態管理が複雑化した場合、Zustand や Jotai などの軽量な状態管理ライブラリの導入を検討します。

## 8. その他考慮事項
* **リアルタイム機能:** Supabase Realtime の Postgres Changes 機能は直接利用できません。家計簿データのリアルタイム同期が必要な場合は、WebSocket を使うなど別途実装方法を検討する必要があります。
* **開発の複雑性:** SPA + BaaS 構成と比較して、SSR 設定、API 実装、認証連携、DB 接続、複数クラウド/サービスの管理など、開発・設定項目が増加します。
* **AWS Lambda の制約:** コールドスタート、実行時間制限、同時実行数などの Lambda の特性を考慮して実装する必要があります。API Gateway の設定も必要です。

---
