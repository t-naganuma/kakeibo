# (ファイル名: 技術選定.md)

# Kakeibo 技術選定

**バージョン:** 1.0
**作成日:** 2025年4月19日

## 1. 概要
このドキュメントは、Kakeiboの開発における主要な技術スタックとアーキテクチャ方針を定義します。

## 2. アーキテクチャ
* **サーバーサイドレンダリング (SSR)** を採用します。
* バックエンドサーバー (API提供、SSR実行) とフロントエンド (UI) を分離しつつ連携させる構成です。

## 3. バックエンド
* **フレームワーク:** **Hono**
    * 高速で軽量な Web フレームワーク。様々な JavaScript ランタイムで動作。
* **ホスティング:** **Cloudflare Workers**
    * Hono との親和性が高く、エッジコンピューティング環境で高いパフォーマンスが期待できる。
* **役割:**
    * フロントエンド (React) への API 提供。
    * React アプリケーションのサーバーサイドレンダリング (SSR) 実行。
    * ビジネスロジック（計算、バリデーションなど）の実装。

## 4. データベース
* **サービス:** **Supabase DB**
    * Supabase が提供するマネージド PostgreSQL データベースを利用 (DBaaS として活用)。
* **接続方法:** Cloudflare Workers 上の Hono アプリから Supabase DB へ接続します。具体的な接続戦略（TCP Socket API, Data API (PostgREST) 経由など）は別途検討が必要です。

## 5. 認証
* **サービス:** **Supabase Auth**
    * ユーザー登録、ログイン、セッション管理などの認証基盤として利用します。
* **連携方法:**
    * フロントエンドで Supabase Auth ライブラリを利用して認証処理を行う。
    * 取得した認証トークン (JWT) を API リクエスト時に Hono サーバーへ送信する。
    * Hono サーバー側でミドルウェア等を用いて JWT を検証し、ユーザーを識別する（`@supabase/ssr` 等の活用を検討）。
    * SSR 時の認証状態管理（Cookie 等の利用）も考慮が必要です。

## 6. フロントエンド
* **ライブラリ:** **React**
    * コンポーネントベースの UI 構築ライブラリ。
* **ルーティング:** **React Router v7**
    * SSR 環境との連携を考慮しつつ、データローディング (`loader`) やミューテーション (`action`) 機能も活用します。
* **UI コンポーネント:** **shadcn/ui**
    * Tailwind CSS ベースのコンポーネント集。Headless UI/Radix UI ベースでカスタマイズ性が高い。
* **スタイリング:** **Tailwind CSS**
    * ユーティリティファーストの CSS フレームワーク。
* **フォーム:** **Conform**
    * Web 標準に準拠し、React Router の `action` との連携がスムーズなフォームライブラリ。
* **ビルドツール:** **Vite**
    * 高速な開発サーバーとビルド機能を提供。Hono や React SSR との連携設定を行います。

## 7. 状態管理
* **基本方針:** React 標準の Context API、`useState`, `useReducer` を中心に利用します。
* **必要に応じて:** アプリケーションの状態管理が複雑化した場合、Zustand や Jotai などの軽量な状態管理ライブラリの導入を検討します。

## 8. その他考慮事項
* **リアルタイム機能:** Supabase Realtime の Postgres Changes 機能は直接利用できません。家計簿データのリアルタイム同期が必要な場合は、WebSocket を使うなど別途実装方法を検討する必要があります。
* **開発の複雑性:** SPA + BaaS 構成と比較して、SSR 設定、API 実装、認証連携、DB 接続など、開発・設定項目が増加します。
* **Cloudflare Workers の制約:** CPU 時間、メモリ使用量、リクエスト/レスポンスサイズなどの実行時制約を考慮して実装する必要があります。

---
